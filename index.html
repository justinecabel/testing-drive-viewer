
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Gallery (Test Mode)</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        #gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 15px; /* A bit more space */
            justify-content: center;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        #gallery img {
            width: 250px;
            height: 250px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        #gallery img:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        #status {
            font-size: 1.2em;
            text-align: center;
            padding-top: 40px;
            color: #555;
        }
    </style>
</head>
<body>

    <h1>My Google Drive Gallery</h1>
    
    <div id="status">Loading test images...</div>
    
    <div id="gallery"></div>


    <script>

        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwq0mGmYDjb9CeL3XR3sOylMMTBmXwebqU84ma2mFzp2PbXW2Ui2Orgmb6j8QDaBLOIOA/exec";


        // Get references to the HTML elements
        const galleryContainer = document.getElementById('gallery');
        const statusDisplay = document.getElementById('status');

        /**
         * Helper function to build the gallery from a list of image sources
         * @param {string[]} imageSources - An array of image URLs
         */
        function buildGallery(imageSources) {
            if (!imageSources || imageSources.length === 0) {
                statusDisplay.innerText = "No images found.";
                return;
            }

            // Clear the gallery first
            galleryContainer.innerHTML = '';
            
            // Loop through each source and create an <img> tag
            imageSources.forEach(src => {
                let img = document.createElement('img');
                img.src = src;
                img.alt = 'Gallery image';
                galleryContainer.appendChild(img);
            });
            
            statusDisplay.style.display = 'none'; // Hide status message
        }

        /**
         * Load from Google Apps Script using JSONP to avoid CORS/CORB.
         * The Apps Script must support a `callback` query parameter and return
         * JavaScript calling that callback with the JSON payload (see gs.gs).
         */
        function loadGalleryFromGoogle() {
            console.log("Running in LIVE mode (JSONP)");
            statusDisplay.innerText = "Loading images from Google Drive...";

            const callbackName = 'driveGalleryCallback_' + Math.floor(Math.random() * 1e9);

            // Create the global callback
            window[callbackName] = function(imageIdsOrError) {
                try {
                    if (!imageIdsOrError) {
                        statusDisplay.innerText = "No response or empty payload.";
                        return;
                    }
                    if (Array.isArray(imageIdsOrError)) {
                        const imageSources = imageIdsOrError.map(id => 'https://drive.usercontent.google.com/download?id=' + id + '&export=view&authuser=0');
                        buildGallery(imageSources);
                    } else if (imageIdsOrError.error) {
                        console.error('Server error:', imageIdsOrError);
                        statusDisplay.innerText = 'Server error: ' + (imageIdsOrError.error || 'unknown');
                    } else {
                        console.warn('Unexpected response format', imageIdsOrError);
                        statusDisplay.innerText = 'Unexpected response format. Check console.';
                    }
                } finally {
                    // cleanup
                    try { delete window[callbackName]; } catch (e) { window[callbackName] = undefined; }
                    const s = document.getElementById(callbackName + '_script'); if (s) s.remove();
                }
            };

            // Inject script tag
            const script = document.createElement('script');
            script.id = callbackName + '_script';
            script.src = WEB_APP_URL + (WEB_APP_URL.indexOf('?') === -1 ? '?' : '&') + 'callback=' + callbackName + '&_=' + Date.now();
            script.onerror = function(e) {
                console.error('Failed to load JSONP script', e);
                statusDisplay.innerText = 'Failed to load gallery script. Check console.';
                try { delete window[callbackName]; } catch (err) { window[callbackName] = undefined; }
                script.remove();
            };
            document.body.appendChild(script);
        }

        
        window.onload = loadGalleryFromGoogle;
        
        // ---------------------------------------------------------------

    </script>
</body>
</html>